```markdown
# Thumbnails Auto Scraping Workflow

## General Description

This n8n workflow automates the process of scraping YouTube videos, extracting their thumbnails, and storing them. It retrieves video information from the YouTube API, extracts thumbnails, prepares them for download, uploads the thumbnails to Google Drive, inserts video and thumbnail metadata into Supabase, and provides status updates via Slack.

## Step-by-step operation

1.  **Déclencheur Quotidien (Cron Trigger):**
    *   **Role:** Triggers the workflow automatically every day at 2 AM.

2.  **Initialisation (Code Node):**
    *   **Role:** Initializes the workflow by setting up configuration parameters like the target number of videos, the YouTube search query ("n8n videos"), and retrieves the workflow ID. Outputs a JSON object containing these settings.

3.  **Slack - Début (Slack Node):**
    *   **Role:** Sends a Slack message at the start of the workflow to the "automation-alerts" channel, indicating that the scraping process has begun. The message includes details about the search query and target videos.

4.  **YouTube API - Recherche (HTTP Request Node):**
    *   **Role:** Makes a request to the YouTube Data API (using the `search` endpoint) to retrieve video data based on the search query defined in the `Initialisation` node. It searches for videos published within the last 7 days.

5.  **Traitement Données YouTube (Code Node):**
    *   **Role:** Processes the YouTube API response.  It extracts relevant data (video title, description, channel information, and thumbnails URLs) from the search results. It prepares two arrays, one for videos and the other for thumbnails, for subsequent processing.  Also, detects and manages errors in processing.

6.  **Videos prepared (Code Node):**
    *   **Role:** Transforms the array of videos into individual items, each containing the data of a single video, preparing them for insertion into Supabase.

7.  **Supabase - Insert Vidéos (Supabase Node):**
    *   **Role:** Inserts video data (title, description, channel details, published date, scraped date, and URL) into a "videos" table in Supabase.

8.  **Thumbnails prepared (Code Node):**
    *   **Role:** Transforms the array of thumbnails into individual items, each containing the data of a single thumbnail, preparing them for insertion into Supabase.

9.  **Préparation Téléchargements (Code Node):**
    *   **Role:** Prepares the thumbnails for download. Specifically, it selects the 'high' and 'maxres' thumbnails URLs generated by previous node and creates a new object with their URL and filename.

10. **Téléchargement Miniatures (HTTP Request Node):**
    *   **Role:** Downloads the selected thumbnails based on the URLs generated.

11. **Upload Google Drive (Google Drive Node):**
    *   **Role:** Uploads the downloaded thumbnail images to a specified Google Drive folder ("Youtube Thumbnails").

12. **Compilation Statistiques (Code Node):**
    *   **Role:** Compiles the final statistics of the workflow, counting the total processed items, successful uploads, and failed uploads and calculates workflow execution duration.

13. **Slack - Succès (Slack Node):**
    *   **Role:** Sends a success message to the "automation-logs" Slack channel with the compiled statistics, including the number of processed videos, successful uploads, failures, and execution time.

14. **Gestionnaire d'Erreurs (Code Node):**
    *   **Role:** A global error handler that catches any errors that occur during the workflow execution. Formats the error details for reporting.

15. **Slack - Erreur (Slack Node):**
    *   **Role:** Sends an error message to the "automation-logs" Slack channel with error details if any error occurs during the process.

16. **When clicking ‘Execute workflow’ (Manual Trigger Node):**
    *   **Role:** Provides a manual trigger point to start the workflow on demand. It is linked to the `Initialisation` node.

## Dependencies or services used

*   **YouTube Data API:** Used to retrieve video information and thumbnails.
*   **Slack:** Used for sending status updates and error notifications.
*   **Supabase:** Used to store video and thumbnail metadata.
*   **Google Drive:** Used for storing downloaded thumbnails.

## Scheduled execution

*   The workflow is scheduled to run automatically every day at 2 AM via the Cron trigger.
*   It can also be triggered manually by clicking "Execute workflow".

## Tips or remarks

*   Make sure you have the correct API keys/credentials configured for the YouTube Data API, Slack, Supabase and Google Drive.
*   The YouTube search query and the number of target videos can be adjusted in the `Initialisation` node.
*   Ensure that the Google Drive folder and the Supabase table exist before running the workflow.
```